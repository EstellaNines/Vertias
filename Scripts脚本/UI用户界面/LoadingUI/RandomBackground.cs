using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class RandomBackground : MonoBehaviour
{
    [Header("171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777")]
    [Tooltip("171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777")]
    public Image backgroundImage;

    [Tooltip("Resources171177117117771171177117117777171177117117771711770171177011711771171177771711771171177711711771171177771711771171177711711771171177771711771171177701711771171177701711771171177701711771171177721711771171177711711771171177771711771171177701711771171177741711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177717117711711777171177117117771171177117117777171177117117771171177117117777")]
    public string backgroundFolderPath = "LoadingBackground";

    [Tooltip("171177117117771171177117117777171177117117770171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117772171177117117771171177117117777171177117117770171177117117778171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777")]
    public bool setRandomOnEnable = true;

    [Tooltip("17117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777171177117117741171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777")]
    public float fadeTransitionTime = 0.5f;

    [Tooltip("171177117117770171177117117771171177117117771171177117117777171177117117770171177117117775171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774")]
    public string[] supportedExtensions = { "", "_1", "_2", "_3", "_4", "_5", "_6", "_7", "_8", "_9" };

    private List<Sprite> loadedSprites = new List<Sprite>();

    private void Awake()
    {
        LoadBackgroundSprites();
    }

    private void OnEnable()
    {
        if (setRandomOnEnable)
        {
            SetRandomBackground();
        }
    }

    void Start()
    {
        // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777OnEnable171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777Start171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
        if (!setRandomOnEnable)
        {
            SetRandomBackground();
        }
    }

    // 171177117117771171177117117777171177117117771171177117117777Resources17117711711777117117711711777717117711711777017117711711777417117711711777117117711711777717117711711777117117711711777717117711711777171177117117781171177117117777171177117117771171177117117777171177117117771171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772
    private void LoadBackgroundSprites()
    {
        loadedSprites.Clear();

        // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777Resources/LoadingBackground17117711711777117117711711777717117711711777017117711711777417117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777171177017117761171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772
        Sprite[] sprites = Resources.LoadAll<Sprite>(backgroundFolderPath);

        if (sprites != null && sprites.Length > 0)
        {
            loadedSprites.AddRange(sprites);
            Debug.Log($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777 Resources/{backgroundFolderPath} 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777 {sprites.Length} 171177117117771171177117117777171177117117770171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772");
        }
        else
        {
            Debug.LogWarning($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777 Resources/{backgroundFolderPath} 171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772");

            // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117771171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777background, background_1, background_2171177117117771171177117117777171177117117770171177117117772171177117117771171177117117777
            for (int i = 0; i < supportedExtensions.Length; i++)
            {
                string spriteName = $"{backgroundFolderPath}/background{supportedExtensions[i]}";
                Sprite sprite = Resources.Load<Sprite>(spriteName);
                if (sprite != null)
                {
                    loadedSprites.Add(sprite);
                    Debug.Log($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772 - {spriteName}");
                }
            }
        }

        if (loadedSprites.Count == 0)
        {
            Debug.LogError($"RandomBackground: 171177117117771171177117117777171177117117771171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777 Resources/{backgroundFolderPath} 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771711770171177117117711711777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777");
        }
    }

    // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772
    public void SetRandomBackground()
    {
        if (backgroundImage == null)
        {
            Debug.LogWarning("RandomBackground: 17117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777017117711711777017117711711777017117711711777217117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777171177017117711171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777");
            return;
        }

        if (loadedSprites.Count == 0)
        {
            Debug.LogWarning("RandomBackground: 17117711711777017117711711777417117711711777117117711711777717117711711777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117771171177117117770171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117774171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777");
            LoadBackgroundSprites();

            if (loadedSprites.Count == 0)
            {
                Debug.LogError("RandomBackground: 17117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777017117711711777417117711711777117117711711777717117711711777117117711711777717117711711777117117711711777817117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777017117711711777617117711711777017117711711777417117711711777117117711711777717117711711777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117771171177117117770171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772");
                return;
            }
        }

        // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117775171177117117771171177117117777171177117117771171177117117777171177117117770171177117117775171177117117771171177117117777171177117117770171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772
        int randomIndex = Random.Range(0, loadedSprites.Count);
        Sprite selectedSprite = loadedSprites[randomIndex];

        if (selectedSprite != null)
        {
            // 1711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177701711771171177751711771171177711711771171177771711771171177711711771171177771711771171177711711771171177761711771171177711711771171177771711771171177711711771171177771711771171177717117711711777171177117117771171177117117777171177117117771171177117117777
            if (fadeTransitionTime > 0)
            {
                StartCoroutine(FadeToNewBackground(selectedSprite));
            }
            else
            {
                // 171177117117770171177117117771171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117779171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
                backgroundImage.sprite = selectedSprite;
                Debug.Log($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772 - {selectedSprite.name}");
            }
        }
        else
        {
            Debug.LogWarning($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777 {randomIndex} 171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777");
        }
    }

    // 17117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777117117711711777617117711711777117117711711777717117711711777117117711711777717117711711777117117711711777717117711711777171177117117741171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
    private IEnumerator FadeToNewBackground(Sprite newSprite)
    {
        Color originalColor = backgroundImage.color;

        // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
        float elapsedTime = 0;
        while (elapsedTime < fadeTransitionTime / 2)
        {
            elapsedTime += Time.deltaTime;
            float alpha = Mathf.Lerp(originalColor.a, 0, elapsedTime / (fadeTransitionTime / 2));
            backgroundImage.color = new Color(originalColor.r, originalColor.g, originalColor.b, alpha);
            yield return null;
        }

        // 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772
        backgroundImage.sprite = newSprite;
        Debug.Log($"RandomBackground: 171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772 - {newSprite.name}");

        // 1711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177711711771171177771711771171177717117711711777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
        elapsedTime = 0;
        while (elapsedTime < fadeTransitionTime / 2)
        {
            elapsedTime += Time.deltaTime;
            float alpha = Mathf.Lerp(0, originalColor.a, elapsedTime / (fadeTransitionTime / 2));
            backgroundImage.color = new Color(originalColor.r, originalColor.g, originalColor.b, alpha);
            yield return null;
        }

        // 171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117776171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117772
        backgroundImage.color = originalColor;
    }

    // 171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117771171177117117777171177117117771171177117117777171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117773171177117117770171177117117773171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117770171177117117770171177117117770171177117117772171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777171177117117771171177117117777
    public int GetLoadedSpritesCount()
    {
        return loadedSprites.Count;
    }
}
