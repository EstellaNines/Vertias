# TPS 战斗系统开发日志

## 开发日志

### TPS v0.1.1 (06.07 21:51)

* **新增功能** ：添加子弹散布功能，使得射击过程更具真实感和策略性，玩家需要更精准地控制射击方向和力度来命中目标。
* **修复问题** ：修复了角色、敌人、丧尸、障碍图层的碰撞与触发器问题，提升了游戏世界的交互性和物体之间的物理反应合理性，避免出现穿模、碰撞检测失效等异常情况。

### TPS v0.1.2 (06.08 23:31)

* **修复问题** ：修复玩家角色的碰撞体为触发器问题，确保玩家角色在游戏世界中与其他物体的碰撞交互正常，不会出现不合理的穿透或触发异常行为。
* **功能优化与重制** ：重制玩家角色拾取物品功能与逻辑，优化后的拾取系统更加稳定、高效，减少了拾取物品时的卡顿和错误，提高了玩家获取资源的便利性和流畅度。

### TPS v0.1.2-1 (06.09 16:48)

* **修复问题** ：修复武器因拾取方向导致武器的 Y 轴翻转错误的问题，现在武器的显示和操作方向更加符合玩家的预期，不会因为拾取方向的不同而出现武器显示异常的情况。
* **逻辑调整与优化** ：将翻转 Y 轴逻辑从玩家角色的 Hand 子对象转移至作为 Hand 对象的子对象 Weapon 上，实现武器的 Y 轴翻转而不是手部的 Y 轴翻转，使得武器的展示和操作更加自然、合理，符合实际的物理规律和玩家的操作习惯。
* **脚本新增** ：新建一个物品管理脚本用于存放物品基础数据，为后续的物品系统拓展和管理提供了更规范、更便捷的数据存储和调用方式，有利于物品属性、功能的统一管理和维护。

### TPS v0.2.0 (06.10 - 06.11)

* **项目拓展** ：新增 Gitee 仓库存放和备份项目，保障项目的源代码安全，方便团队成员在不同环境下进行代码的共享、协作和版本管理，同时也为项目的长期发展和维护提供了更可靠的存储保障。

### TPS v0.2.0-1 (06.12 10:36)

* **功能新增** ：增加远程攻击敌人的扇形检测的可视化射线检测基础机制，初步实现了对远程攻击范围内敌人的检测功能，但该功能仍处于试验阶段，存在许多需要进一步优化和完善的问题，如检测精度、性能消耗、与游戏场景的适配性等方面。

### TPS v0.2.0-2 (06.13 22:36)

* **功能调整** ：删除远程攻击敌人的扇形检测，由于该功能在实际应用中暴露出较多问题，暂时放弃该方案，转而采用更成熟、稳定的技术方案来实现远程攻击的检测功能。
* **插件引入与功能实现** ：添加 A \* 寻路插件，并根据公开可用的 API 实现原有的丧尸 Zombie 对象的追击范围内 A \* 自动寻路功能，使丧尸的移动更加智能化，能够根据路径规划自动寻找并追击玩家，大大增强了游戏的挑战性和紧张感，提升了游戏的可玩性和沉浸感。

### TPS v0.2.0-3 (06.14 12:19)

* **功能增加** ：增加一个网格生成器FieldOfView，用于生成一个扇形区域，可以用来未来敌人检测玩家位置是否在这个可视化位置内，在范围内是潜行状态则不会有反应，在范围内则会反应并攻击玩家。

### TPS v0.2.0-4 (06.18 11:38)
  
* **功能增加** ：给远程攻击的敌人增加了一个Circlecollider2D触发器，用于检测玩家是否进入了敌人的视线范围

### TPS v0.2.0-4 (06.19 16:27)
  
* **功能调整** ：调整触发器与碰撞体，并修改Bullet脚本适配新的capsule碰撞体
* **功能增加** ：增加敌人持有武器，并根据玩家位置瞄准玩家

### TPS v0.2.0-5 (06.20 22:46)
  
* **功能增加** ：增加了敌人开火脚本EnemyFire，控制敌人在玩家进入范围后对玩家开火
* **功能增加** ：增加了敌人子弹池，用于管理敌人开枪时生成的子弹实例
* **功能调整** ：调整了所有人物的碰撞关系，规定使用CapsuleCollider2D来作为所有人物的碰撞体，其他类型碰撞体作为触发或其他功能
* **功能增加** ：设置一个简单的状态机，准备进行Zombie角色的巡逻功能，但是由于状态机设计复杂，以及A*寻路算法的调用问题，现在暂时无法实现巡逻机制，但是其余机制保持完好
* **测试功能删改** ：扇形检测区域设计仍有未解决问题，暂时修改为圆形范围检测，在一定学习后重新尝试使用扇形检测

### TPS v0.2.1 (06.23 23:02)
  
* **完整的丧尸状态机** ：重置了所有丧尸敌人的脚本，将原有的单功能脚本控制各种状态（待机、追击、攻击、受伤、死亡）的单独脚本重制为由单独的有限状态机IState与Zombie脚本完整控制所有丧尸状态。
* **检查器中文变量**  ：根据网络上一个存在的检查器中文变量脚本代码进行修改与重制化片段，完成了检查器内英语变量显示为中文变量
* **动画器拆解** ：将动画器中过渡状态器拆除，转而使用状态机
* **废弃全部功能脚本** ：废弃了全部丧尸功能脚本

### TPS v0.2.1-1 (06.24 22:16)
  
* **死亡状态动画修改** ：丧尸死亡状态由单一死亡精灵修改为动画器控制死亡动画效果
* **完善了状态机的逻辑** ：通过修改受伤到死亡状态的逻辑，将生命值作为转换条件，当生命值小于0时，进入死亡状态
* **射线检测功能增加与测试** ：增加一个直接通过射线检测呈现扇形区域，测试发现单一射线检测与多条射线检测性能消耗没有明显差异

### TPS v0.2.1-2 (06.25 18:21)
  
* **敌人射线检测功能修改** ：敌人原有的射线检测逻辑是玩家进入检测区后由单独一条射线检测位置，这会导致敌人的斜视！因此将射线检测的逻辑修改，修改成由50条射线的检测区构成，玩家进入检测区后直接报出玩家进入范围，然后通过射线被碰撞体遮挡来确认位置

### TPS v0.2.1-3 （06.26 23:53）
  
* **丧尸巡逻逻辑加入** ：添加了一个全新的巡逻状态逻辑，可以选择多个巡逻点，然后随机分配给丧尸，丧尸将会根据分配到的点自由寻路
* **多丧尸相撞处理** ：在多个丧尸都会进行巡逻时，出现了碰撞后只会寻找一个点后不在巡逻，以及追击玩家跟丢后出现向追击范围最后位置的撞墙，因此添加了一个撞墙处理，检测速度与路径点索引，当两个丧尸相撞后会先冷静一下，然后找回之前记录的路径点，并重新开始巡逻。
* **初步装载玩家状态机** ：添加玩家状态机，以Idle状态为默认状态，重置玩家所有的动作逻辑，并接入潜行的判定以及潜行状态机，现已完成Idle、Move、Dodge基础状态
* **验证敌人检测玩家机制** ：在不消耗性能的同时保证了敌人能够检测到玩家，并完成敌人攻击玩家的逻辑
* **丧尸旧有逻辑完全弃置** ：添加并最后完善了状态机后满足了旧有的所有逻辑并优化逻辑，降低了代码耦合程度

### TPS v0.2.1-4 (06.27 21:48)
  
* **增加玩家潜行功能** ：添加了潜行功能，通过按下C键进入潜行状态，此时玩家变成灰色并降低部分透明度，并预计降低玩家移动速度
* **增加敌人巡逻功能** ：设置了特定巡逻点，敌人会在特定巡逻点中移动，扇形检测也随着移动方向改变
* **增加敌人方向机** ：规定了玩家移动方向的记录，并将数值传递给射线检测，使扇形监测能够始终面向移动方向的前方
* **增加敌人对玩家的检测** ：敌人现在能够根据玩家进入检测范围的状态，判断是否引起注意，并根据在检测范围内不同的状态有着不同的射线颜色
* **增加敌人对玩家的攻击** ：设定一个检测玩家的射线检测，规定白色射线始终对准进入范围的玩家，当白色射线与检测范围重合时，扇形检测的中线会重合白色射线，并看向玩家，此时使用旧有的敌人射击脚本调用敌人对象池创建子弹攻击玩家
* **子弹类型修改** ：子弹现在分为敌人对象池与敌人子弹、玩家对象池与玩家子弹，并分别规定了碰撞图层，解决了玩家子弹会攻击自己的问题
* **玩家状态机(未解决)** ： 玩家状态机中的跑动、拾取等其他功能仍没有装载成状态机，逻辑较为复杂是其中的一个问题，需要重新理解逻辑后重置玩家状态机
* **敌人状态机(后台计划)** ：敌人现在的所有功能均是单独脚本挂载控制，极其消耗性能，预计将会逐步重置成状态机

### TPS v0.2.1-5 (06.28 23:45)
  
* **敌人状态机完全装载** ：将敌人的所有功能拆解，并创建敌人状态机，将敌人的所有功能拆分为Idle状态、Move状态、Attack状态、Patrol状态、Aim状态以及Aim状态子模块WeaponController从而将敌人的扇形射线检测完善，并增加一个敌人武器会瞄准玩家的发射
* **敌人主功能脚本废弃** ：将敌人主功能脚本废弃，并全部放入敌人状态机中
* **敌人检测机制修改** ：从原本的圈层检测，修改为只有玩家进入到扇形视野才会被检测，更加符合敌人逻辑

### TPS v0.2.1-6 (06.29 23:59)
  
* **玩家状态机创建** ：创建玩家状态机，并添加了玩家的移动、待机、跑动、拾取、潜行、翻滚
* **玩家动画状态切换** ：增加了一个公共函数，用于检测玩家的Hand子对象是否存在子对象，若存在则切换到武器状态动画，否则切换到无武器状态动画
* **拾取逻辑修改** ：增加了拾取逻辑的检测Tag，当检测到Tag为武器时能够变成Hand子对象的子对象，并预留后期使用端口
* **修改输入控制器** ：将潜行和跑动的长按逻辑修改，输入检测变为bool值输出

### TPS v0.2.1-6 x0.01 (06.30 23:58)
  
* **玩家状态机功能完善** ：将玩家功能状态机中部分功能测试后再次完善
* **玩家状态机补全** ：玩家状态机剩余的受伤、攻击、死亡状态装载，但是受伤和死亡状态切换仍存在问题
* **丧尸状态机功能问题** ：丧尸攻击完玩家后会呆愣在原地，需要检测这个问题并修改
* **敌人射线检测实体化网格** ：在游戏视角使用了程序生成的网格用于呈现射线检测

### TPS v0.2.2 (0701 22:31)
  
* **玩家状态机完成** ：玩家状态机所有功能已经完成，并修改部分逻辑使状态机切换转态更加流畅
* **武器与玩家敌人操作分离** ：在此版本之前，武器并没有一个很好的管理器管理，导致武器与玩家属于固定关系，玩家能够操控与拾取除了敌人武器以外的所有武器，并且射击；敌人与武器也属于固定模式，敌人只能够使用开始设定好的武器，当敌人死亡后武器掉落，玩家是无法拾取并开枪的。因此修改了武器的逻辑，通过一个管理器脚本将武器单独隔离，使玩家和敌人都能在武器根据父对象是敌人还是玩家后选择瞄准对象，对象池，锁定旋转等功能
* **敌人受伤和死亡状态** ：敌人的受伤动画和受伤状态、死亡动画和死亡状态被添加进状态机，现在敌人有了自己的生命值，可以被玩家击杀。
* **丧尸攻击机制修复** ：经过测试发现，丧尸在攻击一次玩家后就会停止任何动作，进行原地待机，最大的原因是攻击状态中一个判断的错误导致整个攻击状态和待机状态一直来回切换而不是在玩家远离攻击范围后继续巡逻或追击功能。修改了这个逻辑后，丧尸攻击功能正常，并且攻击完成后会正常巡逻和追击。

### TPS v0.2.2-1 (0702 23:55)
  
* **敌人网格视野材质** ： 创建了透明材质FOV，用于显示敌人的视野
* **敌人网格视野显示** ： 通过脚本FOV完成了敌人的扇形检测范围的FOV视野显示，并且视野显示的所有参数与敌人的玩家检测功能相同，会随着玩家移动旋转以及死亡后的消失
* **子弹预制体和子弹池的分离** ：将敌人子弹预制体和玩家子弹预制体拆分，并通过对象池用字典标注以及WeaponManger脚本管理双状态子弹预制体，即玩家子弹预制体和敌人子弹预制体都可以被武器使用，当玩家使用武器时，武器调用的是玩家子弹预制体和对象池；反之则是敌人的子弹预制体和对象池。
* **场景UI界面基础属性布置** ：绘制了3个基础属性的图标以及数值条，摆放在屏幕的左上角，并使用一个FillLine脚本管理与玩家Player的数值（生命值、饱食度、精神值）；并通过这一功能实现数值条根据玩家状态减少填充
* **场景提示UI布置** ：绘制了一些操作提醒的UI图标，放置在屏幕的左侧，配合文字说明按键提醒
* **藏身处地图场景重置** ：瓦片地图出现大量不适配问题，因此重新调整了瓦片地图，并重新铺设

### TPS v0.2.2-2 (0704 01:02)
  
* **藏身处场景优化** ：重置了场景Shelter，然后为场景重新铺设了一个新的瓦片地图，并做好层级处理，同时场景中所有物体都添加了相应的碰撞体
* **预制体修改** ：将玩家、丧尸、敌人、武器的对象修改为预制体，并将敌人拆分成两个，一个是站立敌人、一个是巡逻敌人，可以使后期更加方便处理场景切换时预制体直接产生等问题
* **场景图修改** ：场景中的图片经过重新绘制
* **购物中心场景图片绘制完成** ：参考了一定的商店内部场景与外观的参考，然后完成绘制购物中心场景的精灵图片

### TPS v0.2.3 (0705 00:49)
  
* **修改藏身处地图的碰撞**  ：场景Shelter中有大量不适合的碰撞体，通过修改将碰撞体完善
* **限制藏身处边界** ： 增加四个边界碰撞体，使玩家走不出场景
* **增加藏身处切换场景内地图位置** ：增加2个通用传送脚本（室外、室内传送）从藏身处外部场景切换到室内场景
* **增加购物中心场景** ：绘制购物中心的场景瓦片，然后通过规则瓦片绘制场景地板，然后修改和调整建筑瓦片，绘制大场景的建筑物
* **增加购物中心室内场景** ：绘制购物中心的室内场景瓦片，绘制场景地板，然后绘制物体图片，放置场景内物品
* **增加购物中心场景碰撞和排序图层** ：增加场景碰撞检测，调整图片和瓦片的显示顺序
* **增加换弹UI显示，武器UI显示** ：增加换弹UI显示，武器UI显示

### TPS V0.2.3-1 (0706 23:55)
  
* **修改藏身处室内布局** ：藏身处室内布局从原来的正方形大房间修改为小房间，并将内部陈设与布局修改，同时重新设置了碰撞体
* **修改物品的放置方式** ：室内物品的方式方式从瓦片地图修改为对象放置，更有利于其他效果的实现和碰撞的设置
* **增加降低物品透明度功能** ：设置一个大碰撞触发器用于检测玩家进入物品区域，当玩家进入物品区域时，物品透明度降低，当玩家离开物品区域时，物品透明度恢复
* **修改指引提示的显示** ：将指引UI修改为进入场景后2秒显示，然后隐藏
* **修改子弹池效果** ：由于子弹池涉及到玩家的多场景使用，因此将子弹池设计改为单例模式并且永不销毁，同步修改武器和敌人的子弹池管理，自动寻找单例模式下的子弹池并使用

### TPS v0.2.3-2 (0708 23:55)
  
* **背包UI界面绘制** ：完成了背包UI界面的绘制，包括基础属性显示，人物的背包、护甲、偷窥、仓库等UI的图像设计

### TPS v0.2.3-2 (0709 22:03)
  
* **背包内任务面绘制** ：完成了地图场景内背包界面查看任务的界面。设定了完整界面，但是存在大量修改建议
* **部分图标绘制完成** ：根据UI需求完成了部分已经完成设计的UI界面的图标绘制

### TPS v0.2.3-2 (0711 00:26)
  
* **异步加载场景以及加载UI** ：完成异步加载场景以及加载UI的实现，并完成场景切换的实现，并完成UI的加载
* **拾取文本和高亮材质提示** ：新增物品在玩家拾取范围时显示提示文本，并增加高亮描边材质，用于高亮物品并描边

### TPS v0.2.3-3 (0712 01:16)
  
* **战斗UI增加** ：增加一个换弹UI动画，实现更明显的换弹显示
* **背包三个界面UI板块设置** ：完成背包三个界面的UI板块初步设置

### TPS v0.2.4 (0713 01:47)
  
* **UI交互功能增加** ：增加了整个界面的交互功能，能够通过点击“背包”“任务”“地图”的按钮打开对应UI界面
* **UI任务界面完整布置** ：完成任务界面的完整布置，并添加了任务列表，任务描述等界面元素
* **UI界面交互增加** ：增加了点击任务栏中任务条的功能，点击后会切换一个确认图片，并在右侧展示所有任务描述，包括任务类型、任务名称、任务发布者、任务图例、任务描述、任务奖励
* **JSON文件生成脚本增加** ：直接使用脚本生成JSON文件在Project右键可以直接生成JSON文件，并自动将JSON文件保存在Assets/Resources目录下
* **JSON文件数据存储** ：将所有的任务类型、任务名称、任务发布者、任务图例、任务描述、任务奖励信息和图标图片等数据全部使用JSON文件存储和修改
* **任务管理器** ：增加一个调控整个任务界面的管理器，用于读取数据，控制交互，并保存数据

### TPS v0.2.4-1 (0713 19:48)
  
* **调整任务UI界面** ：将任务奖励信息UI通过JSON数据设定的奖励类型可以自动生成奖励信息预制体然后自动排序
* **背包UI预制体** ：将背包UI的三个板块分别完成独立的预制体嵌合到主背包预制体当中，每次跨场景加载背包UI每个预制体独立加载，不影响性能
* **加载场景随机图例** ：现在拥有多个图例用于加载场景，每次进入加载界面都是随机选择一个图例

### TPS v0.2.4-2 (0714-0717)

* **完善背包UI的任务界面** ：修改了任务界面的UI配合和位置

### TPS v0.2.4-3 (0719 21:39)
  
* **地图UI部署** ：完成了地图UI界面的布局，并实现了完整的地图展示
* **地图UI交互1** ：完成了地图UI能够通过鼠标长按实现地图的拖动，鼠标滚轮实现地图的定点缩放
* **地图UI交互2** ：完成地图UI部署了多个按钮，并设置好了一定的UI交互表现

### TPS v0.2.4-4 (0722 00:30)

* **地点缩略图和描述** ：完成了地点缩略图的绘制、并添加了每一个地点的描述

### TPS v0.2.4-5 (0723 22:30)

* **地图UI传送功能增加** ：现在可以直接通过背包UI中的地图UI按钮实现传送到另一个场景功能，但是传送有点问题，需要研究解决

### TPS v0.2.4-6 (0728 20:56)

* **地图UI重置** ：使用全新架构重制地图UI，使用更加简便的脚本以及与JSON文件高度嵌合，再通过消息传递功能实现按钮间JSON文件数据传递，并预留全局消息收发接口，为全场景传送功能预留接口位置，更加简便实现传送。
* **过场图片效果修改** ：像素转换器增加平滑因子功能可以是图片的一些像素点通过OpenCV和邻近算法整合成平滑的图片，使图片效果不会过于混乱。

### TPS v0.2.4-7 (0729 22:32)

* **地图传送功能实现** ：地图传送功能实现，可以通过地图UI的UI按钮实现场景传送
* **加载UI界面** ：加载UI界面，在异步加载时候显示加载界面

### TPS v0.2.5 (0731 20:53)

* **地图传送功能修改并完全实现** ：之前完成的地图传送功能存在一定问题，在添加了加载UI后，会发现这个地图传送，传送一次后就无法再次传送，经过检查发现是MapConfirmController脚本和SceneLoader脚本在每次传送后都会将地图UI和传送功能解绑，经过修改后可以实现无限次数传送

* **加载UI界面信息显示** ：重置了加载UI界面，从原来的全屏图片修改为右侧小图片+地图文字描述和加载文本显示，并重新制作了18张加载图片用于随机化生成地图描述和图片；未来会加入进度UI显示和进度条

* **背包系统网格创建** ：背包系统的网格界面正在实现构建，同时正在制作大格子坐标获取功能，以实现后续的物品吸附，物品大小不同的排布和放置功能做基础脚本

### TPS v0.2.5-1 (0801 23:52)

* **网格背包构建** ：现在完成了一个基础的网格背包，能够自定义背包大小，拥有选取、存放、边界控制、高亮等功能

* **无背景物品图片修改** ：将物品的背景去除，并将物品根据分类放置在一个png文件方便物品数据生成

* **物品数据**：现在有一个ItemData的ScriptObject存放了物品图片的大小数据，后续会结合JSON文件存储其他数据

### TPS v0.2.5-2 (0805 22:04)

* **物品预制体重建** :物体的预制体从原来的单个"物品"预制体被拆分为11个独立分类的预制体,同时这些预制体均为BaseItem预制体的子类物品, 并且每一个分类物品预制体都有自己的框架脚本,方便读取JSON文件数据.

* **物品背景生成** :物品的背景图片生成脚本已实现,生成图片的尺寸和物品图片一致,并且图片的背景色是根据物品的品质来确定颜色

* **物品交互重置** :原来的交互方式不适合多分类物品, 因此重置了交付脚本,实现多类型物品和多背包之间的操作

* **其他类型物品加入** :继续加入其他物品的数据

* **程序化生产物品** :物品的生成可以不在依赖按键的操控, 现在有一个一键生成物品的脚本,可以实现顺序或随机生成,同时根据需求数量和类型生成物品

* **物品生成器接口开放** :物品生成脚本提供了多个接口方便后续的操作

### TPS v0.2.5-3 (0806 23:55)

* **物品装备栏设定** : 添加了一个全新的物品装备栏, 设置为背包装备栏, 但是经过多次尝试都无法变为装备背包, 问题出在网格背包的代码层上的网格被写死,导致物品无法从网格坐标切换到正常坐标,导致背包栏持续为空, 随后弃置这个背包系统

* **新网格背包构思** : 将重新设计网格架构和数据结构, 使用SO对象设立物品数据,JSON文件负责保存; 网格系统坐标系重新设计; 网格交互使用unity内置系统
 
### TPS V0.2.5 (0808 01:22)

* **物品数据重新设计** : 采用现在JSON问价设计基础保存数据, 然后创建一个一键生成SO对象的脚本, 通过JSON文件录入的数据首先初建第一批静态物品数据对象, 并开放这个SO的itemdata接口, 是运行和结束保存过程中都能写出修改数据, 运行动态修改. 并且以后更多物品只需要通过录入JSON文件即可直接生成SO对象

* **物品结构修改** : 初版物品,各大类物品只是用对应大类的主预制体, 导致背包栏装备时无法识别具体的物品预制体, 只能通过名称确定该预制体可以被放入背包栏, 造成了数据溢出, 第二版物品将使用独立的预制体. 并通过脚本一键创建由SO对象所需组件为基础的预制体, 这个脚本也是方便后续添加的.

* **物品占据网格大小可视化** : 修改了一个ItemData的简单视窗, 可以在检查器直接看到物品的大小

* **优化了原有的物品JSON文件** : 原有物品JSON文件由于每个物品的功能不同,导致每一次都需强加载Resources中JSON文件来重新读取物品的所有数据, 导致运行时间长后, 后台进程堆积无数个JSON数据库, 容易造成卡顿.