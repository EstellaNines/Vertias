# TPS 战斗系统开发日志

## 开发日志

### TPS v0.1.1 (06.07 21:51)

  * **新增功能** ：添加子弹散布功能，使得射击过程更具真实感和策略性，玩家需要更精准地控制射击方向和力度来命中目标。
  * **修复问题** ：修复了角色、敌人、丧尸、障碍图层的碰撞与触发器问题，提升了游戏世界的交互性和物体之间的物理反应合理性，避免出现穿模、碰撞检测失效等异常情况。

### TPS v0.1.2 (06.08 23:31)

  * **修复问题** ：修复玩家角色的碰撞体为触发器问题，确保玩家角色在游戏世界中与其他物体的碰撞交互正常，不会出现不合理的穿透或触发异常行为。
  * **功能优化与重制** ：重制玩家角色拾取物品功能与逻辑，优化后的拾取系统更加稳定、高效，减少了拾取物品时的卡顿和错误，提高了玩家获取资源的便利性和流畅度。

### TPS v0.1.2-1 (06.09 16:48)

  * **修复问题** ：修复武器因拾取方向导致武器的 Y 轴翻转错误的问题，现在武器的显示和操作方向更加符合玩家的预期，不会因为拾取方向的不同而出现武器显示异常的情况。
  * **逻辑调整与优化** ：将翻转 Y 轴逻辑从玩家角色的 Hand 子对象转移至作为 Hand 对象的子对象 Weapon 上，实现武器的 Y 轴翻转而不是手部的 Y 轴翻转，使得武器的展示和操作更加自然、合理，符合实际的物理规律和玩家的操作习惯。
  * **脚本新增** ：新建一个物品管理脚本用于存放物品基础数据，为后续的物品系统拓展和管理提供了更规范、更便捷的数据存储和调用方式，有利于物品属性、功能的统一管理和维护。

### TPS v0.2.0 (06.10 - 06.11)

  * **项目拓展** ：新增 Gitee 仓库存放和备份项目，保障项目的源代码安全，方便团队成员在不同环境下进行代码的共享、协作和版本管理，同时也为项目的长期发展和维护提供了更可靠的存储保障。

### TPS v0.2.0-1 (06.12 10:36)

  * **功能新增** ：增加远程攻击敌人的扇形检测的可视化射线检测基础机制，初步实现了对远程攻击范围内敌人的检测功能，但该功能仍处于试验阶段，存在许多需要进一步优化和完善的问题，如检测精度、性能消耗、与游戏场景的适配性等方面。

### TPS v0.2.0-2 (06.13 22:36)

  * **功能调整** ：删除远程攻击敌人的扇形检测，由于该功能在实际应用中暴露出较多问题，暂时放弃该方案，转而采用更成熟、稳定的技术方案来实现远程攻击的检测功能。
  * **插件引入与功能实现** ：添加 A \* 寻路插件，并根据公开可用的 API 实现原有的丧尸 Zombie 对象的追击范围内 A \* 自动寻路功能，使丧尸的移动更加智能化，能够根据路径规划自动寻找并追击玩家，大大增强了游戏的挑战性和紧张感，提升了游戏的可玩性和沉浸感。

### TPS v0.2.0-3 (06.14 12:19)

  * **功能增加** ：增加一个网格生成器FieldOfView，用于生成一个扇形区域，可以用来未来敌人检测玩家位置是否在这个可视化位置内，在范围内是潜行状态则不会有反应，在范围内则会反应并攻击玩家。

### TPS v0.2.0-4 (06.18 11:38)
  
  * **功能增加** ：给远程攻击的敌人增加了一个Circlecollider2D触发器，用于检测玩家是否进入了敌人的视线范围

### TPS v0.2.0-4 (06.19 16:27)
  
  * **功能调整** ：调整触发器与碰撞体，并修改Bullet脚本适配新的capsule碰撞体
  * **功能增加** ：增加敌人持有武器，并根据玩家位置瞄准玩家

### TPS v0.2.0-5 (06.20 22:46)
  * **功能增加** ：增加了敌人开火脚本EnemyFire，控制敌人在玩家进入范围后对玩家开火
  * **功能增加** ：增加了敌人子弹池，用于管理敌人开枪时生成的子弹实例
  * **功能调整** ：调整了所有人物的碰撞关系，规定使用CapsuleCollider2D来作为所有人物的碰撞体，其他类型碰撞体作为触发或其他功能
  * **功能增加** ：设置一个简单的状态机，准备进行Zombie角色的巡逻功能，但是由于状态机设计复杂，以及A*寻路算法的调用问题，现在暂时无法实现巡逻机制，但是其余机制保持完好
  * **测试功能删改** ：扇形检测区域设计仍有未解决问题，暂时修改为圆形范围检测，在一定学习后重新尝试使用扇形检测

### TPS v0.2.1 (06.23 23:02)
  * **完整的丧尸状态机** ：重置了所有丧尸敌人的脚本，将原有的单功能脚本控制各种状态（待机、追击、攻击、受伤、死亡）的单独脚本重制为由单独的有限状态机IState与Zombie脚本完整控制所有丧尸状态。
  * **检查器中文变量**  ：根据网络上一个存在的检查器中文变量脚本代码进行修改与重制化片段，完成了检查器内英语变量显示为中文变量
  * **动画器拆解** ：将动画器中过渡状态器拆除，转而使用状态机
  * **废弃全部功能脚本** ：废弃了全部丧尸功能脚本

### TPS v0.2.1-1 (06.24 22:16)
  * **死亡状态动画修改** ：丧尸死亡状态由单一死亡精灵修改为动画器控制死亡动画效果
  * **完善了状态机的逻辑** ：通过修改受伤到死亡状态的逻辑，将生命值作为转换条件，当生命值小于0时，进入死亡状态
  * **射线检测功能增加与测试** ：增加一个直接通过射线检测呈现扇形区域，测试发现单一射线检测与多条射线检测性能消耗没有明显差异

### TPS v0.2.1-2 (06.25 18:21)
  * **敌人射线检测功能修改** ：敌人原有的射线检测逻辑是玩家进入检测区后由单独一条射线检测位置，这会导致敌人的斜视！因此将射线检测的逻辑修改，修改成由50条射线的检测区构成，玩家进入检测区后直接报出玩家进入范围，然后通过射线被碰撞体遮挡来确认位置

### TPS v0.2.1-3 （06.26 23:53）
  * **丧尸巡逻逻辑加入** ：添加了一个全新的巡逻状态逻辑，可以选择多个巡逻点，然后随机分配给丧尸，丧尸将会根据分配到的点自由寻路
  * **多丧尸相撞处理** ：在多个丧尸都会进行巡逻时，出现了碰撞后只会寻找一个点后不在巡逻，以及追击玩家跟丢后出现向追击范围最后位置的撞墙，因此添加了一个撞墙处理，检测速度与路径点索引，当两个丧尸相撞后会先冷静一下，然后找回之前记录的路径点，并重新开始巡逻。
  * **初步装载玩家状态机** ：添加玩家状态机，以Idle状态为默认状态，重置玩家所有的动作逻辑，并接入潜行的判定以及潜行状态机，现已完成Idle、Move、Dodge基础状态
  * **验证敌人检测玩家机制** ：在不消耗性能的同时保证了敌人能够检测到玩家，并完成敌人攻击玩家的逻辑
  * **丧尸旧有逻辑完全弃置** ：添加并最后完善了状态机后满足了旧有的所有逻辑并优化逻辑，降低了代码耦合程度

### TPS v0.2.1-4 (06.27 21:48)
  * **增加玩家潜行功能** ：添加了潜行功能，通过按下C键进入潜行状态，此时玩家变成灰色并降低部分透明度，并预计降低玩家移动速度
  * **增加敌人巡逻功能** ：设置了特定巡逻点，敌人会在特定巡逻点中移动，扇形检测也随着移动方向改变
  * **增加敌人方向机** ：规定了玩家移动方向的记录，并将数值传递给射线检测，使扇形监测能够始终面向移动方向的前方
  * **增加敌人对玩家的检测** ：敌人现在能够根据玩家进入检测范围的状态，判断是否引起注意，并根据在检测范围内不同的状态有着不同的射线颜色
  * **增加敌人对玩家的攻击** ：设定一个检测玩家的射线检测，规定白色射线始终对准进入范围的玩家，当白色射线与检测范围重合时，扇形检测的中线会重合白色射线，并看向玩家，此时使用旧有的敌人射击脚本调用敌人对象池创建子弹攻击玩家
  * **子弹类型修改** ：子弹现在分为敌人对象池与敌人子弹、玩家对象池与玩家子弹，并分别规定了碰撞图层，解决了玩家子弹会攻击自己的问题
  * **玩家状态机(未解决)** ： 玩家状态机中的跑动、拾取等其他功能仍没有装载成状态机，逻辑较为复杂是其中的一个问题，需要重新理解逻辑后重置玩家状态机
  * **敌人状态机(后台计划)** ：敌人现在的所有功能均是单独脚本挂载控制，极其消耗性能，预计将会逐步重置成状态机

### TPS v0.2.1-5 (06.28 23:45)
  * **敌人状态机完全装载** ：将敌人的所有功能拆解，并创建敌人状态机，将敌人的所有功能拆分为Idle状态、Move状态、Attack状态、Patrol状态、Aim状态以及Aim状态子模块WeaponController从而将敌人的扇形射线检测完善，并增加一个敌人武器会瞄准玩家的发射
  * **敌人主功能脚本废弃** ：将敌人主功能脚本废弃，并全部放入敌人状态机中
  * **敌人检测机制修改** ：从原本的圈层检测，修改为只有玩家进入到扇形视野才会被检测，更加符合敌人逻辑

### TPS v0.2.1-6 (06.29 23:59)
  * **玩家状态机创建** ：创建玩家状态机，并添加了玩家的移动、待机、跑动、拾取、潜行、翻滚
  * **玩家动画状态切换** ：增加了一个公共函数，用于检测玩家的Hand子对象是否存在子对象，若存在则切换到武器状态动画，否则切换到无武器状态动画
  * **拾取逻辑修改** ：增加了拾取逻辑的检测Tag，当检测到Tag为武器时能够变成Hand子对象的子对象，并预留后期使用端口
  * **修改输入控制器** ：将潜行和跑动的长按逻辑修改，输入检测变为bool值输出

### TPS v0.2.1-6 x0.01 (06.30 23:58)
  * **玩家状态机功能完善** ：将玩家功能状态机中部分功能测试后再次完善
  * **玩家状态机补全** ：玩家状态机剩余的受伤、攻击、死亡状态装载，但是受伤和死亡状态切换仍存在问题
  * **丧尸状态机功能问题** ：丧尸攻击完玩家后会呆愣在原地，需要检测这个问题并修改
  * **敌人射线检测实体化网格** ：在游戏视角使用了程序生成的网格用于呈现射线检测

### TPS v0.2.2 (0701 22:31)
  * **玩家状态机完成** ：玩家状态机所有功能已经完成，并修改部分逻辑使状态机切换转态更加流畅
  * **武器与玩家敌人操作分离** ：在此版本之前，武器并没有一个很好的管理器管理，导致武器与玩家属于固定关系，玩家能够操控与拾取除了敌人武器以外的所有武器，并且射击；敌人与武器也属于固定模式，敌人只能够使用开始设定好的武器，当敌人死亡后武器掉落，玩家是无法拾取并开枪的。因此修改了武器的逻辑，通过一个管理器脚本将武器单独隔离，使玩家和敌人都能在武器根据父对象是敌人还是玩家后选择瞄准对象，对象池，锁定旋转等功能
  * **敌人受伤和死亡状态** ：敌人的受伤动画和受伤状态、死亡动画和死亡状态被添加进状态机，现在敌人有了自己的生命值，可以被玩家击杀。
  * **丧尸攻击机制修复** ：经过测试发现，丧尸在攻击一次玩家后就会停止任何动作，进行原地待机，最大的原因是攻击状态中一个判断的错误导致整个攻击状态和待机状态一直来回切换而不是在玩家远离攻击范围后继续巡逻或追击功能。修改了这个逻辑后，丧尸攻击功能正常，并且攻击完成后会正常巡逻和追击。